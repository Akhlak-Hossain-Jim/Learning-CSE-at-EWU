-- For Programiz

-- DROP TABLE Customers;
-- DROP TABLE Orders;
-- DROP TABLE Shippings;


-- Code starts here

-- TASK 1
CREATE TABLE ACCOUNT(
  ACCOUNT_NO CHAR(5),
  BALANCE NUMBER NOT NULL,
  CONSTRAINT APK PRIMARY KEY (ACCOUNT_NO),
  CONSTRAINT ACB CHECK (BALANCE > 0)
);

CREATE TABLE CUSTOMER(
  CUSTOMER_NO CHAR(5),
  CUSTOMER_NAME VARCHAR2(20) NOT NULL,
  CUSTOMER_CITY VARCHAR2(10),
  CONSTRAINT CPK PRIMARY KEY (CUSTOMER_NO)
);

CREATE TABLE DEPOSITOR(
  ACCOUNT_NO CHAR(5),
  CUSTOMER_NO CHAR(5),
  CONSTRAINT DPK PRIMARY KEY (ACCOUNT_NO, CUSTOMER_NO)
);

-- TASK 2

ALTER TABLE CUSTOMER 
ADD date_of_birth DATE;

DESC CUSTOMER

ALTER TABLE CUSTOMER 
DROP COLUMN date_of_birth;

DESC CUSTOMER

ALTER TABLE DEPOSITOR 
RENAME COLUMN ACCOUNT_NO TO A_NO;
ALTER TABLE DEPOSITOR 
RENAME COLUMN CUSTOMER_NO TO C_NO;

DESC CUSTOMER

ALTER TABLE DEPOSITOR 
ADD CONSTRAINT depositor_fk1 
FOREIGN KEY (A_NO) REFERENCES ACCOUNT(ACCOUNT_NO);
ALTER TABLE DEPOSITOR 
ADD CONSTRAINT depositor_fk2 
FOREIGN KEY (C_NO) REFERENCES CUSTOMER(CUSTOMER_NO);

DESC CUSTOMER

-- TASK 3

INSERT INTO ACCOUNT(ACCOUNT_NO, BALANCE) 
VALUES('A-101', 12000);
INSERT INTO ACCOUNT(ACCOUNT_NO, BALANCE) 
VALUES('A-102', 6000);
INSERT INTO ACCOUNT(ACCOUNT_NO, BALANCE) 
VALUES('A-103', 2500);

INSERT INTO CUSTOMER(CUSTOMER_NO, CUSTOMER_NAME, CUSTOMER_CITY) 
VALUES('C-101', 'Alice', 'Dhaka');
INSERT INTO CUSTOMER(CUSTOMER_NO, CUSTOMER_NAME, CUSTOMER_CITY) 
VALUES('C-102', 'Annie', 'Dhaka');
INSERT INTO CUSTOMER(CUSTOMER_NO, CUSTOMER_NAME, CUSTOMER_CITY) 
VALUES('C-103', 'Bob', 'Chittagong');
INSERT INTO CUSTOMER(CUSTOMER_NO, CUSTOMER_NAME, CUSTOMER_CITY) 
VALUES('C-104', 'Charlie', 'Khulna');

INSERT INTO DEPOSITOR(A_NO, C_NO) 
VALUES('A-101', 'C-101');
INSERT INTO DEPOSITOR(A_NO, C_NO) 
VALUES('A-103', 'C-101');
INSERT INTO DEPOSITOR(A_NO, C_NO) 
VALUES('A-103', 'C-102');
INSERT INTO DEPOSITOR(A_NO, C_NO) 
VALUES('A-102', 'C-103');
INSERT INTO DEPOSITOR(A_NO, C_NO) 
VALUES('A-103', 'C-104');

-- TASK 4

SELECT CUSTOMER_NAME, CUSTOMER_CITY
FROM CUSTOMER;

SELECT DISTINCT CUSTOMER_CITY
FROM CUSTOMER;

SELECT ACCOUNT_NO
FROM ACCOUNT
WHERE BALANCE > 7000;

SELECT CUSTOMER_NO, CUSTOMER_NAME
FROM CUSTOMER
WHERE CUSTOMER_CITY = 'Khulna';

SELECT CUSTOMER_NO, CUSTOMER_NAME
FROM CUSTOMER
WHERE NOT CUSTOMER_CITY = 'Dhaka';

SELECT c.CUSTOMER_NAME, c.CUSTOMER_CITY
FROM CUSTOMER c
JOIN DEPOSITOR d ON c.CUSTOMER_NO = d.C_NO
JOIN ACCOUNT a ON d.A_NO = a.ACCOUNT_NO
WHERE a.BALANCE > 7000;

SELECT c.CUSTOMER_NAME, c.CUSTOMER_CITY
FROM CUSTOMER c
JOIN DEPOSITOR d ON c.CUSTOMER_NO = d.C_NO
JOIN ACCOUNT a ON d.A_NO = a.ACCOUNT_NO
WHERE a.BALANCE > 7000 AND NOT c.CUSTOMER_CITY = 'Khulna';

SELECT a.ACCOUNT_NO, a.BALANCE
FROM ACCOUNT a
JOIN DEPOSITOR d ON a.ACCOUNT_NO = d.A_NO
WHERE d.C_NO = 'C-102';

SELECT a.ACCOUNT_NO, a.BALANCE
FROM ACCOUNT a
JOIN DEPOSITOR d ON a.ACCOUNT_NO = d.A_NO
JOIN CUSTOMER c ON d.C_NO = c.CUSTOMER_NO
WHERE c.CUSTOMER_CITY IN ('Dhaka', 'Khulna');

SELECT c.CUSTOMER_NO, c.CUSTOMER_NAME
FROM CUSTOMER c
LEFT JOIN DEPOSITOR d ON c.CUSTOMER_NO = d.C_NO
WHERE d.C_NO IS NULL;

INSERT INTO CUSTOMER (CUSTOMER_NO, CUSTOMER_NAME, CUSTOMER_CITY)
VALUES ('C-105', 'Diana', 'Sylhet');

SELECT c.CUSTOMER_NO, c.CUSTOMER_NAME
FROM CUSTOMER c
LEFT JOIN DEPOSITOR d ON c.CUSTOMER_NO = d.C_NO
WHERE d.C_NO IS NULL;
